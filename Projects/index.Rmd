---
title: ''
output: rmdformats::downcute
date: "`r Sys.Date()`"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(tidyr)
library(readxl)
library(janitor)
library(lubridate)
library(gganimate)
library(transformr)
library(ggplot2)
library(stringr)
library(gganimate)
library(gifski)
library(skimr)
library(GGally)
library(tidygeocoder)
library(caret)
library(ROCR)
library(pROC)

install.packages('ROCR')

# Load the data 
ttc <- read.csv("ttc-bus-delay-data-2022.csv")

# Clean the data 
ttc$Date <- as.Date(ttc$Date, format = "%d-%b-%y")
ttc$time_posi <- as.POSIXct(strptime(ttc$Time, format = "%H:%M"), 
                            format = "%d-%b-%y %H:%M", tz = "UTC")


ttc$time <- hour(ttc$time_posi) + (minute(ttc$time_posi)/60)

ttc <- janitor::clean_names(ttc)
```


```{r echo=FALSE, out.width="50%", fig.align='center'}
knitr::include_graphics("./Media/publictransit_TTC.png")
```

The Toronto Transit Commission (TTC) is Toronto's public transportation system. It is a vast network that covers Toronto and the surrounding municipalities, which are collectively known as the Greater Toronto Area (GTA). The TTC operates subways, buses, and streetcars throughout the region, making it possible to travel to almost any destination. The bus system is particularly extensive, with routes that reach almost every corner of the city. The TTC is one of the fastest and most convenient ways to get around Toronto and the GTA, and I highly recommend it to anyone visiting or living in the area.


```{r time, echo=FALSE,warning=FALSE}

ggplot(ttc, aes(x = time_2, y = min_delay)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE) +
  # Customize x-axis breaks and labels
  scale_x_continuous(
    breaks = seq(0, 24, by = 3),  # Adjust the breaks as needed
    labels = c("12:00 AM", "3:00 AM", "6:00 AM", "9:00 AM", "12:00 PM", "3:00 PM", "6:00 PM", "9:00 PM", "12:00 AM")
  ) +
  labs(
    title = "Relationship between Time of Day and Bus Delay",
    x = "Time of Day",
    y = "Min Delay"
  )

```

```{r route,echo=FALSE,warning=FALSE}

x.order <- 
ttc %>% 
  group_by(route) %>% 
  summarize(max = max(min_delay)) %>% 
  arrange(desc(max)) %>% 
  pluck("route")

#min_dealy and route
plot1 <- 
ggplot(ttc %>% 
         mutate(route=factor(route,levels=x.order)), aes(x = route, y = min_delay)) +
  geom_violin() +
  # Add a linear regression line
  geom_smooth(method = "lm", se = FALSE) +
  theme(axis.text.x = element_blank())

plotly::ggplotly(plot1)
```


```{r date,echo=FALSE,warning=FALSE}
ggplot(ttc, aes(x = date, y = min_delay)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE) +
  scale_x_date(
    date_breaks = "1 month",  # Set breaks to 1 month
    date_labels = "%b %Y",    # Format labels as abbreviated month and year
    limits = c(min(ttc$date), max(ttc$date))  # Set limits based on your data
  ) +
  labs(
    title = "Relationship between Date and Bus Delay",
    x = "Date",
    y = "Min Delay"
  )

```


```{r location,echo=FALSE,warning=FALSE}

ggplot(ttc, aes(x = location, y = min_delay)) +
  geom_point() +
  # Add a linear regression line
  geom_smooth(method = "lm", se = FALSE)
```

## Is there a particular bus route that is more late than others?

```{r pressure, echo=FALSE}
# Is a particular route more late than others?
route_mean_delays <- ttc %>%
  group_by(route) %>%
  summarise(MeanDelay = mean(min_delay, na.rm = TRUE)) %>%
  arrange(desc(MeanDelay)) %>%
  head(10)

# Create a bar plot to display the routes with the 10 highest mean delays
ggplot(route_mean_delays, aes(x = reorder(route,MeanDelay,decreasing=FALSE), y = MeanDelay)) +
  geom_bar(stat = "identity", fill = "red", color = "blue") +
  labs(
    title = "Top 10 Routes with Highest Mean Delay",
    x = "Route",
    y = "Mean Delay (Minutes)"
  ) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))  # Rotate x-axis labels for better readability
```



## Is there a particular bus route that is more on time than others?

```{r pressure2, echo=FALSE}
# Calculate the mean delay for each route
all_route_delay <- ttc %>%
  group_by(route) %>%
  summarise(MeanDelay = mean(min_delay))

# Sort routes by mean delay in descending order
all_route_delay_summary <- all_route_delay %>%
  arrange(desc(MeanDelay))


# what routs are on time the most often 
route_mean_on_time <- ttc %>%
  group_by(route) %>%
  summarise(MeanDelay = mean(min_delay, na.rm = FALSE)) %>%
  arrange(MeanDelay) %>%
  head(10)

# Create a bar plot to display the routes with the 10 lowest mean delays
#
ggplot(route_mean_on_time, aes(x = reorder(route,MeanDelay,decreasing=TRUE),route, y = MeanDelay)) +
  geom_bar(stat = "identity", fill = "lightgreen", color = "darkgreen") +
  labs(
    title = "Top 10 Routes with Lowest Mean Delay (Most On-Time Routes)",
    x = "Route",
    y = "Mean Delay (Minutes)"
  ) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))  # Rotate x-axis labels
```



```{r, echo=FALSE}
# On what day is the bus most likey going to be late? 
# Calculate the average delay for each day of the week?
# Create an ordered factor for days of the week
ttc$day <- factor(ttc$day, levels = c("Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"))

# Calculate the average delay for each day of the week
average_delays <- ttc %>%
  group_by(day) %>%
  summarise(AvgDelay = mean(min_delay, na.rm = TRUE))

# Bar plot to visualize the average delays
ggplot(average_delays, aes(x = day, y = AvgDelay)) +
  geom_bar(stat = "identity", fill = "blue") +
  labs(title = "Average Delay by Day of the Week",
       x = "Day of the Week",
       y = "Average Delay (Minutes)") +
  theme_minimal()

```




















# Citations:

Data source: https://www.kaggle.com/datasets/reihanenamdari/toronto-bus-delay-2022

[1]https://en.wikipedia.org/wiki/

[2]https://arrivein.com/daily-life-in-canada/getting-around-how-to-use-public-transportation-in-toronto/

[3]https://www.prepareforcanada.com/choosing-a-city/toronto/public-transportation-system-in-torontoride-the-ttc/

[4]https://apollocover.com/magazine/toronto-public-transportation

[5]https://en.wikipedia.org/wiki/Toronto_Transit_Commission_bus_system

[6]https://travel.usnews.com/Toronto/Getting_Around/
